apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "canis.fullname" . }}-didcomm-lb-config
  labels:
    app: {{ include "canis.fullname" . }}-didcomm-lb
data:
  canis-lb-config.yaml: |-
    ###############################################################
    #
    #  DIDComm Load Balancer
    #
    ###############################################################
    inbound:
      host: 0.0.0.0
      httpPort: 9003
      wsPort: 9001
      external: "ws://172.16.1.1:{{if ne .Values.loadbalancerIP ""}}9001{{ else }}30001{{end}}"

    ###############################################################
    #
    #  AMQP Server (rabbitMQ)
    #
    ###############################################################
    amqp:
      user: canis
      password: canis
      host: 172.16.1.1
      port: 5672
      vhost: canis

    ###############################################################
    #
    #  Datastore configuration
    #
    ###############################################################
    datastore:
      {{- toYaml .Values.datastore | nindent 6 }}

    ###############################################################
    #
    #  GRPC Server
    #
    ###############################################################
    loadbalancer:
      grpc:
        host: 0.0.0.0
        port: 9996

    ###############################################################
    #
    #  Ledger-store configuration
    #
    ###############################################################
    ledgerstore:
      {{- toYaml .Values.ledgerstore | nindent 6 }}
